---
- ansible.builtin.debug: msg="START connection={{ ansible_connection }} nxos_os_install upgrade"
  when: connection is defined

- ansible.builtin.set_fact: image_dir='/auto/fe_ssr/agents-ci/agents_images/release_images/hamilton/REL_9_2_1/'

- ansible.builtin.set_fact: checkmode='no'

- ansible.builtin.set_fact: issu='desired'

- ansible.builtin.set_fact: copy_images=True

- ansible.builtin.set_fact: force=False

- ansible.builtin.set_fact: delete_files=True

- ansible.builtin.set_fact:
    delete_image_list:
      - nxos*.bin

- name: Unconfigure features that will conflict with upgrade
  ignore_errors: true
  cisco.nxos.nxos_config:
    lines:
      - terminal dont-ask
      - no feature ngmvpn
    match: none

- ansible.builtin.set_fact: si='nxos.9.2.1.bin'

- name: Upgrade n9k device to hamilton release image
  ansible.builtin.include: targets/nxos_install_os/tasks/upgrade/main_os_install.yaml
