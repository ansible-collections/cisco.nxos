---
- ansible.builtin.debug:
    msg: START connection={{ ansible_connection }} nxos_os_install upgrade
  when: connection is defined

- ansible.builtin.set_fact:
    image_dir: /auto/fe_ssr/agents-ci/agents_images/release_images/greensboro/REL_7_0_3_I7_4/

- ansible.builtin.set_fact:
    checkmode: false

- ansible.builtin.set_fact:
    issu: desired

- ansible.builtin.set_fact:
    copy_images: true

- ansible.builtin.set_fact:
    force: true

- ansible.builtin.set_fact:
    delete_files: true

- set_fact:
    delete_image_list:
      - nxos*.bin

- name: Unconfigure features that will conflict with upgrade
  ignore_errors: true
  cisco.nxos.nxos_config:
    lines:
      - terminal dont-ask
      - no feature nv overlay
      - no nxapi ssl protocols
      - no nxapi ssl ciphers weak
    match: none

- ansible.builtin.set_fact:
    si: nxos.7.0.3.I7.4.bin

- name: Upgrade N9k Device to Greensboro Release Image
  include: targets/nxos_install_os/tasks/upgrade/main_os_install.yaml
