---
- ansible.builtin.include: targets/nxos_install_os/tasks/upgrade/delete_files.yaml
  when: delete_files

- ansible.builtin.include: targets/nxos_install_os/tasks/upgrade/copy_kick_system_images.yaml ansible_connection=ansible.netcommon.network_cli connection={{ cli }}
  when: copy_images

- ansible.builtin.include: targets/nxos_install_os/tasks/upgrade/install_with_kick.yaml
  when: ki is defined

- ansible.builtin.include: targets/nxos_install_os/tasks/upgrade/install_system.yaml
  when: ki is undefined

- ansible.builtin.meta: reset_connection

- name: Check installed os for newly installed version {{ tv }}
  register: output
  cisco.nxos.nxos_command:
    commands:
      - show version | json

- ansible.builtin.debug: msg="Version detected {{ output['stdout_lines'][0]['kickstart_ver_str'] }}"
